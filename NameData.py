# 原始数据
_maps_name_zh = ["万圣夜","梦境世界","辉针城","特殊"]
_maps_name_en = ["Halloween","Dream","Castle","Special"]
_maps_id = ["mvz2:halloween","mvz2:dream","mvz2:castle","another"] 

_level_name_zh = ["测试关卡","教程关","序章","星之碎片教程关","驱动教程关"]
_level_name_en = ["debug","tutorial","prologue","starshard_tutorial","trigger_tutorial"]
_level_id = ["mvz2:debug","mvz2:tutorial","mvz2:prologue","mvz2:starshard_tutorial","mvz2:trigger_tutorial"]
level_day = ["1","2","3","4","5","6","7","8","9","10","11","endless"]

_artifact_name_zh = ["空","图鉴","锄头","梦境钥匙","怪物的心","安眠枕","槐树树枝","梦蝶","暗物质","智能手机","倒置的镜子","万宝槌仿制品","凋零骷髅头","下界之星","破灯笼"]
_artifact_name_en = ["Empty","almanac","hoe","dream_key","the_creatures_heart","sweet_sleep_pillow","pagoda_branch","dream_butterfly","dark_matter","smart_phone","inverted_mirror","miracle_mallet_replica","wither_skeleton_skull","nether_star","broken_lantern"]
_artifact_id = ["None","mvz2:almanac","mvz2:hoe","mvz2:dream_key","mvz2:the_creatures_heart","mvz2:sweet_sleep_pillow","mvz2:pagoda_branch","mvz2:dream_butterfly","mvz2:dark_matter","mvz2:smart_phone","mvz2:inverted_mirror","mvz2:miracle_mallet_replica","mvz2:wither_skeleton_skull","mvz2:nether_star","mvz2:broken_lantern"]

_blueprint_name_zh = ["发射器", "熔炉", "黑曜石", "地雷TNT", "小型发射器", "月光传感器", "荧石", "冲击活塞", "TNT", "灵魂熔炉", "银质发射器", "魔术箱", "睡莲", "驱动发射器", "重力板", "漩涡漏斗", "活塞发射器", "图腾发射器", "梦境结晶", "美梦丝", "木制投掷器", "尖刺方块", "石制投掷器", "石护罩", "金苹果", "雷鼓", "磁暴线圈", "巨碗", "传染发射器", "传动力板", "金制投掷器", "钻石尖刺", "铁砧", "随机瓷器", "僵尸", "皮帽僵尸", "铁盔僵尸", "旗帜僵尸", "骷髅", "石像鬼", "幽灵", "木乃伊", "死灵法师", "蜘蛛", "洞穴蜘蛛", "恶魂", "恐怖之母", "恐怖寄生虫", "催眠者", "狂战士", "无头骑士", "地狱战车", "灵魂沙王", "突变僵尸", "超级突变僵尸", "小鬼僵尸", "骨墙", "小幽灵", "反则卫星", "骷髅马", "无头骑士的头", "灵魂沙", "正邪的诅咒人偶", "床战士", "石像鬼雕像", "科学怪人的怪物", "瘦长鬼影", "梦魇收割者", "鬼人正邪", "凋灵", "矿车", "南瓜马车", "彩虹猫", "噩梦猫", "碗车", "红石", "绿宝石", "红宝石", "蓝宝石", "钻石", "通关掉落物", "制品掉落物", "星之碎片", "arrow", "mine_tnt_seed", "snowball", "large_snowball", "flying_tnt", "soulfire_ball", "knife", "bullet", "missile", "fire_charge", "large_arrow", "spike", "spike_ball", "diamond_caltrop", "dart", "poison_javelin", "parabot", "breakout_pearl", "wooden_ball", "cobble", "boulder", "golden_ball", "compelling_orb", "seija_magic_bomb", "seija_bullet", "wither_skull", "miner", "mine_debris", "fragment", "star_particles", "gem_effect", "smoke", "broken_armor", "thunder_bolt", "evocation_star", "shine_ring", "stun_stars", "stunning_flash", "explosion", "soulfire", "soulfire_burn", "soulfire_blast", "mummy_gas", "burning_gas", "heal_particles", "bone_particles", "blood_particles", "smoke_cluster", "rain", "electric_arc", "gore_particles", "frankenstein_jump_trail", "frankenstein_head", "splash_particles", "gear_particles", "pow", "vortex", "giant_spike", "fire_breath", "weakness_gas", "magnetic_line", "hoe", "breakout_board", "nightmare_watching_eye", "nightmare_portal", "dark_matter_particles", "nightmareaper_splash", "nightmareaper_shadow", "slice_spark", "梦魇碾压墙", "nightmareaper_timer", "floating_text", "nightmare_darkness", "nightmare_glass", "spike_particles", "diamond_spike_particles", "mind_control_lines", "mutant_zombie_weapon", "water_lightning_particles", "thunder_cloud", "magic_bomb_explosion", "seija_camera_frame", "seija_faint_effect", "wither_summoners", "castle_twilight"]
_blueprint_name_en = ["dispenser", "furnace", "obsidian", "mine_tnt", "small_dispenser", "moonlight_sensor", "glowstone", "punchton", "tnt", "soul_furnace", "silvenser", "magichest", "lily_pad", "drivenser", "gravity_pad", "vortex_hopper", "pistenser", "totenser", "dream_crystal", "dream_silk", "wooden_dropper", "spike_block", "stone_dropper", "stone_shield", "golden_apple", "thunder_drum", "tesla_coil", "giant_bowl", "infectenser", "force_pad", "golden_dropper", "diamond_spikes", "anvil", "random_china", "zombie", "leather_capped_zombie", "iron_helmetted_zombie", "flag_zombie", "skeleton", "gargoyle", "ghost", "mummy", "necromancer", "spider", "cave_spider", "ghast", "mother_terror", "parasite_terror", "mesmerizer", "berserker", "dullahan", "hell_chariot", "anubisand", "mutant_zombie", "mega_mutant_zombie", "imp", "bone_wall", "napstablook", "reverse_satellite", "skeleton_horse", "dullahan_head", "soulsand", "seija_cursed_doll", "bedserker", "gargoyle_statue", "frankenstein", "slenderman", "nightmareaper", "seija", "wither", "minecart", "pumpkin_carriage", "nyan_cat", "nyaightmare", "bowl_chariot", "redstone", "emerald", "ruby", "sapphire", "diamond", "clear_pickup", "artifact_pickup", "starshard", "arrow", "mine_tnt_seed", "snowball", "large_snowball", "flying_tnt", "soulfire_ball", "knife", "bullet", "missile", "fire_charge", "large_arrow", "spike", "spike_ball", "diamond_caltrop", "dart", "poison_javelin", "parabot", "breakout_pearl", "wooden_ball", "cobble", "boulder", "golden_ball", "compelling_orb", "seija_magic_bomb", "seija_bullet", "wither_skull", "miner", "mine_debris", "fragment", "star_particles", "gem_effect", "smoke", "broken_armor", "thunder_bolt", "evocation_star", "shine_ring", "stun_stars", "stunning_flash", "explosion", "soulfire", "soulfire_burn", "soulfire_blast", "mummy_gas", "burning_gas", "heal_particles", "bone_particles", "blood_particles", "smoke_cluster", "rain", "electric_arc", "gore_particles", "frankenstein_jump_trail", "frankenstein_head", "splash_particles", "gear_particles", "pow", "vortex", "giant_spike", "fire_breath", "weakness_gas", "magnetic_line", "hoe", "breakout_board", "nightmare_watching_eye", "nightmare_portal", "dark_matter_particles", "nightmareaper_splash", "nightmareaper_shadow", "slice_spark", "crushing_walls", "nightmareaper_timer", "floating_text", "nightmare_darkness", "nightmare_glass", "spike_particles", "diamond_spike_particles", "mind_control_lines", "mutant_zombie_weapon", "water_lightning_particles", "thunder_cloud", "magic_bomb_explosion", "seija_camera_frame", "seija_faint_effect", "wither_summoners", "castle_twilight"]
_blueprint_id = ["mvz2:dispenser", "mvz2:furnace", "mvz2:obsidian", "mvz2:mine_tnt", "mvz2:small_dispenser", "mvz2:moonlight_sensor", "mvz2:glowstone", "mvz2:punchton", "mvz2:tnt", "mvz2:soul_furnace", "mvz2:silvenser", "mvz2:magichest", "mvz2:lily_pad", "mvz2:drivenser", "mvz2:gravity_pad", "mvz2:vortex_hopper", "mvz2:pistenser", "mvz2:totenser", "mvz2:dream_crystal", "mvz2:dream_silk", "mvz2:wooden_dropper", "mvz2:spike_block", "mvz2:stone_dropper", "mvz2:stone_shield", "mvz2:golden_apple", "mvz2:thunder_drum", "mvz2:tesla_coil", "mvz2:giant_bowl", "mvz2:infectenser", "mvz2:force_pad", "mvz2:golden_dropper", "mvz2:diamond_spikes", "mvz2:anvil", "mvz2:random_china", "mvz2:zombie", "mvz2:leather_capped_zombie", "mvz2:iron_helmetted_zombie", "mvz2:flag_zombie", "mvz2:skeleton", "mvz2:gargoyle", "mvz2:ghost", "mvz2:mummy", "mvz2:necromancer", "mvz2:spider", "mvz2:cave_spider", "mvz2:ghast", "mvz2:mother_terror", "mvz2:parasite_terror", "mvz2:mesmerizer", "mvz2:berserker", "mvz2:dullahan", "mvz2:hell_chariot", "mvz2:anubisand", "mvz2:mutant_zombie", "mvz2:mega_mutant_zombie", "mvz2:imp", "mvz2:bone_wall", "mvz2:napstablook", "mvz2:reverse_satellite", "mvz2:skeleton_horse", "mvz2:dullahan_head", "mvz2:soulsand", "mvz2:seija_cursed_doll", "mvz2:bedserker", "mvz2:gargoyle_statue", "mvz2:frankenstein", "mvz2:slenderman", "mvz2:nightmareaper", "mvz2:seija", "mvz2:wither", "mvz2:minecart", "mvz2:pumpkin_carriage", "mvz2:nyan_cat", "mvz2:nyaightmare", "mvz2:bowl_chariot", "mvz2:redstone", "mvz2:emerald", "mvz2:ruby", "mvz2:sapphire", "mvz2:diamond", "mvz2:clear_pickup", "mvz2:artifact_pickup", "mvz2:starshard", "mvz2:arrow", "mvz2:mine_tnt_seed", "mvz2:snowball", "mvz2:large_snowball", "mvz2:flying_tnt", "mvz2:soulfire_ball", "mvz2:knife", "mvz2:bullet", "mvz2:missile", "mvz2:fire_charge", "mvz2:large_arrow", "mvz2:spike", "mvz2:spike_ball", "mvz2:diamond_caltrop", "mvz2:dart", "mvz2:poison_javelin", "mvz2:parabot", "mvz2:breakout_pearl", "mvz2:wooden_ball", "mvz2:cobble", "mvz2:boulder", "mvz2:golden_ball", "mvz2:compelling_orb", "mvz2:seija_magic_bomb", "mvz2:seija_bullet", "mvz2:wither_skull", "mvz2:miner", "mvz2:mine_debris", "mvz2:fragment", "mvz2:star_particles", "mvz2:gem_effect", "mvz2:smoke", "mvz2:broken_armor", "mvz2:thunder_bolt", "mvz2:evocation_star", "mvz2:shine_ring", "mvz2:stun_stars", "mvz2:stunning_flash", "mvz2:explosion", "mvz2:soulfire", "mvz2:soulfire_burn", "mvz2:soulfire_blast", "mvz2:mummy_gas", "mvz2:burning_gas", "mvz2:heal_particles", "mvz2:bone_particles", "mvz2:blood_particles", "mvz2:smoke_cluster", "mvz2:rain", "mvz2:electric_arc", "mvz2:gore_particles", "mvz2:frankenstein_jump_trail", "mvz2:frankenstein_head", "mvz2:splash_particles", "mvz2:gear_particles", "mvz2:pow", "mvz2:vortex", "mvz2:giant_spike", "mvz2:fire_breath", "mvz2:weakness_gas", "mvz2:magnetic_line", "mvz2:hoe", "mvz2:breakout_board", "mvz2:nightmare_watching_eye", "mvz2:nightmare_portal", "mvz2:dark_matter_particles", "mvz2:nightmareaper_splash", "mvz2:nightmareaper_shadow", "mvz2:slice_spark", "mvz2:crushing_walls", "mvz2:nightmareaper_timer", "mvz2:floating_text", "mvz2:nightmare_darkness", "mvz2:nightmare_glass", "mvz2:spike_particles", "mvz2:diamond_spike_particles", "mvz2:mind_control_lines", "mvz2:mutant_zombie_weapon", "mvz2:water_lightning_particles", "mvz2:thunder_cloud", "mvz2:magic_bomb_explosion", "mvz2:seija_camera_frame", "mvz2:seija_faint_effect", "mvz2:wither_summoners", "mvz2:castle_twilight"]

_musics_name_zh = ['疯狂戴夫', '选择你的种子', '草地行走', '莱克死灵之书-关卡', '莱克死灵之书-地图', '狂人的愉悦', '终极之战', '莱克死灵之书-首领', '破碎的童话-关卡', '破碎的童话-地图', '悬念', '以撒的结合', '忏悔', '飞翔于宇宙的不可思议巫女', 'Pandemonic Planet（前段）', 'Pandemonic Planet（后段）', '青空之影', '记忆的回响', '沉默空洞的辉针城', '凋灵舞曲', '有只僵尸在你的手机里', 'Reverse Ideology', '针折线断的天守阁', '辉光之针的小人族 ~ Little Princess', '惊疑星球-首领']
_musics_name_en = ["Crazy Dave", "Choose Your Seeds", "Grasswalk", "Lexonomicon Level", "Lexonomicon Map", "Loon Boon","Utimate Battle", "Lexonomicon Boss", "Fractured Fairytales Level", "Fractured Fairytales Map", "Suspension", "The Binding of Isaac", "Repentant", "The Mysterious Shrine Maiden Flying Through", "Pandemonic Planet (1st part)", "Pandemonic Planet (2nd part)", "A Shadow in the Blue Sky","Fading Echoes of Memory","The Shining Needle Castle Sinking to the Void", "Witherstep", "Zombies in your phone", "Reverse Ideology", "The Exacerbated Castle Keep", "Inchlings of the Shining Needle ~ Little Princess", "Astounding Planet Boss"]
_musics_id = ['mvz2:mainmenu', 'mvz2:choosing', 'mvz2:day', 'mvz2:halloween', 'mvz2:halloween_map', 'mvz2:minigame', 'mvz2:ultimate_battle', 'mvz2:halloween_boss', 'mvz2:dream_level', 'mvz2:dream_map', 'mvz2:suspension', 'mvz2:nightmare_map', 'mvz2:nightmare_level', 'mvz2:nightmare_final', 'mvz2:nightmare_boss', 'mvz2:nightmare_boss2', 'mvz2:gensokyo_map', 'mvz2:distress', 'mvz2:castle_map', 'mvz2:castle_level', 'mvz2:phone_ring', 'mvz2:seija', 'mvz2:sad_shinmyoumaru', 'mvz2:castle_final', 'mvz2:wither_boss']

_difficulty_name_zh = ['简单', '普通', '困难']
_difficulty_name_en = ['Eazy', 'Normal', 'Hard']
_difficulty_id = ['mvz2:eazy', "mvz2:normal", "mvz2:hard"]

_gird_name_zh = ['草地', '水路', '木板']
_gird_name_en = ['grass', 'water', 'wood']
_grid_id = ["mvz2:grass", "mvz2:water", "mvz2:wood"]

_text_data = {'title':                      {'zh': 'MVZ2存档修改器 v2.0 by QoZnoS', 'en': 'MVZ2SaveModifier v2.0 by QoZnoS'
    }, 'status_ready':                      {'zh': '就绪', 'en': 'Ready'
    }, 'btn_save':                          {'zh': '保存文件', 'en': 'Execute the modification'
    }, 'label_user':                        {'zh': '当前用户：', 'en': 'current user: '
    }, 'btn_switch':                        {'zh': '切换', 'en': 'switch'
    }, 'btn_unzip':                         {'zh': '解压 (.dat/.lvl → .json)', 'en': 'Decompress(.dat/.lvl → .json)'
    }, 'btn_zip':                           {'zh': '压缩 (.json → .lvl)', 'en': 'Compress(.json → .lvl)'
    }, 'label_lvl_null':                    {'zh': '当前存档：未选择', 'en': 'current level: empty'
    }, 'btn_lvl':                           {'zh': '选择存档', 'en': 'Select level file'
    }, 'btn_page':                          {'zh': '切换界面', 'en': 'Another page'
    }, 'tree_artifact':                     {'zh': '制品名称', 'en': 'Artifact name'
    }, 'btn_add':                           {'zh': '添加', 'en': 'Add'
    }, 'btn_delete':                        {'zh': '删除', 'en': 'Delete'
    }, 'tree_blueprint':                    {'zh': '蓝图名称', 'en': 'Blueprint name'
    }, 'btn_modify':                        {'zh': '修改', 'en': 'Modify'
    }, 'label_lvl':                         {'zh': '当前文件：', 'en': 'current level: '
    }, 'label_chapter':                     {'zh': '章节：', 'en': 'Chapter: '
    }, 'label_day':                         {'zh': '关卡：', 'en': 'Day: '
    }, 'label_flag':                        {'zh': '旗数：', 'en': 'Flag: '
    }, 'label_wave':                        {'zh': '波数：', 'en': 'Wave: '
    }, 'label_energy':                      {'zh': '当前机械能：', 'en': 'Energy: '
    }, 'label_maxEnergy':                   {'zh': '机械能上限：', 'en': 'maxEnergy: '
    }, 'label_starshard':                   {'zh': '星之碎片数：', 'en': 'Starshard: '
    }, 'label_maxStarshard':                {'zh': '星之碎片槽：', 'en': 'maxStarshard: '
    }, 'label_isConveyorMode':              {'zh': '启用传送带', 'en': 'ConveyorMode'
    }, 'label_conveyorslot':                {'zh': '传送带槽数：', 'en': 'ConveyorSlot: '
    }, 'label_energyActive':                {'zh': '显示机械能', 'en': 'energyVisiable'
    }, 'label_blueprintsActive':            {'zh': '显示蓝图', 'en': 'blueprintVisiable'
    }, 'label_pickaxeActive':               {'zh': '启用镐子', 'en': 'pickaxeEnable'
    }, 'label_starshardActive':             {'zh': '启用星之碎片', 'en': 'starshardEnable'
    }, 'label_triggerActive':               {'zh': '启用驱动', 'en': 'triggerEnable'
    }, 'label_musicID':                     {'zh': '背景音乐：', 'en': 'BGM: '
    }, 'label_autoCollect':                 {'zh': '自动收集', 'en': 'AutoCollect'
    }, 'label_rechargeSpeed':               {'zh': '蓝图无冷却', 'en': 'Cancel Blueprint Cooldown'
    }, 'label_ignoreHugeWaveEvent':         {'zh': '忽略大波事件', 'en': 'Ignore Flag Events'
    }, 'label_difficulty':                  {'zh': '难度：', 'en': 'difficulty: '
    }, 'btn_about':                         {'zh': '关于修改器', 'en': 'About SaveModifier'
    }, 'True':                              {'zh': '是', 'en': 'True'
    }, 'False':                             {'zh': '否', 'en': 'False'
    }, 'status_save':                       {'zh': '已保存到：', 'en': 'Save to: '
    }, 'btn_open_explorer':                 {'zh': '打开存档文件夹', 'en': 'View in Explorer'
    }, 'info_missing':                      {'zh': '参数错误', "en":'Parameter error'
    }, 'info_missing_param':                {'zh': '读取参数失败：', 'en':'Fail to read param: '
    }, 'page_Numeric_Editor':               {'zh': '基础', 'en':'Basic'
    }, 'page_Artifact_Blueprint_Editor':    {'zh': '蓝图/制品', 'en':'Artifact/Blueprint'
    }, 'page_Grids_Editor':                 {'zh': '网格', 'en':'Grids'
    }, 'page_EnemyPool_Editor':             {'zh': '无尽出怪', 'en':'Endless Spawn'
    }, 'label_start_grid':                  {'zh': '请先选择存档', 'en':'Please choose a level file to start'
    }, 'check_enemyPool':                   {'zh': '启用无尽出怪', 'en':'Enable Endless Spawn'
    }
}

_language = "zh"

import winreg,Window

def get_language():
    key_path = r"Software\\Cuerzor\\MinecraftVSZombies2"

    key = winreg.OpenKey(winreg.HKEY_CURRENT_USER,key_path,0,winreg.KEY_READ)
    i = 0
    while True:
        try:
            name, value, _ = winreg.EnumValue(key, i)
            if name.startswith("Language"):
                value_data=value
                break
            i+=1
        except OSError:
            break
    winreg.CloseKey(key)

    if value_data == b'en-US\x00':
        set_language("en")
    elif value_data == b'zh-Hans\x00':
        set_language("zh")
    else:
        choose_language()

def set_language(lang):
    global _language
    if lang == "zh":
        _language = "zh"
    if lang == "en":
        _language = "en"

def choose_language():
    Window.LanguageSelector(on_select=set_language)

get_language()

class BilingualDataset:
    """双语数据集（ID↔名称双向查询）保留原始列表的同时构建索引"""
    def __init__(self, ids, zh_names, en_names):
        # 保留原始列表
        self.ids = ids
        self.zh_names = zh_names
        self.en_names = en_names
        
        # 构建正向索引（ID为键）
        self._by_id = {
            id: {"zh": zh, "en": en} 
            for id, zh, en in zip(ids, zh_names, en_names)
        }
        
        # 构建反向索引（自动生成）
        self._zh_to_id = {zh: id for zh, id in zip(zh_names, ids)}
        self._en_to_id = {en: id for en, id in zip(en_names, ids)}
    
    def get_name(self, item_id, lang=_language):
        """通过ID获取名称 (默认返回中文)"""
        return self._by_id.get(item_id, {}).get(lang)

    def get_id(self, name):
        """通过中文/英文名获取ID"""
        return self._zh_to_id.get(name) or self._en_to_id.get(name)
    
    @property
    def id_list(self):
        """ID列表"""
        return self.ids
    
    @property
    def name_list(self):
        """名称列表"""
        if _language=="zh":
            return self.zh_names
        if _language=="en":
            return self.en_names

class TextManager:
    """改进的文本管理器，保持与BilingualDataset兼容的接口"""
    def __init__(self, data):
        # 构建双向索引
        self._data = data
        self._reverse_index = {}
        
        # 生成兼容属性
        self.ids = list(data.keys())
        self.zh_names = [v['zh'] for v in data.values()]
        self.en_names = [v['en'] for v in data.values()]
        
        # 构建反向索引（中文名→ID，英文名→ID）
        for text_id, texts in data.items():
            self._reverse_index[texts['zh']] = text_id
            self._reverse_index[texts['en']] = text_id
    
    def get_name(self, text_id, lang=_language):
        """兼容原BilingualDataset的调用方式"""
        if text_id in self._data:
            return self._data[text_id].get(lang)
        return f"<Missing Text: {text_id}>"
    
    def get_id(self, name):
        """通过任意语言文本查找ID"""
        return self._reverse_index.get(name)
    
    @property
    def id_list(self):
        return self.ids
    
    @property
    def name_list(self):
        return [self._data[k][_language] for k in self.ids]
    
maps = BilingualDataset(_maps_id, _maps_name_zh, _maps_name_en)
levels = BilingualDataset(_level_id, _level_name_zh, _level_name_en)
artifacts = BilingualDataset(_artifact_id, _artifact_name_zh, _artifact_name_en)
blueprints = BilingualDataset(_blueprint_id, _blueprint_name_zh, _blueprint_name_en)
musics = BilingualDataset(_musics_id, _musics_name_zh, _musics_name_en)
difficultys = BilingualDataset(_difficulty_id, _difficulty_name_zh, _difficulty_name_en)
grids = BilingualDataset(_grid_id, _gird_name_zh, _gird_name_en)
texts = TextManager(_text_data)

bools = BilingualDataset([True,False], ["是","否"], ["Yes","No"])

spawns = ['mvz2:zombie', 'mvz2:leather_capped_zombie', 'mvz2:iron_helmetted_zombie', 'mvz2:flag_zombie', 'mvz2:skeleton', 'mvz2:ghost', 'mvz2:mummy', 'mvz2:necromancer', 'mvz2:spider', 'mvz2:cave_spider', 'mvz2:ghast', 'mvz2:mother_terror', 'mvz2:mesmerizer', 'mvz2:berserker', 'mvz2:dullahan', 'mvz2:hell_chariot', 'mvz2:mutant_zombie', 'mvz2:mega_mutant_zombie']